<!--
Copyright 2019-present Open Networking Foundation
SPDX-FileCopyrightText: 2022 2020-present Open Networking Foundation <info@opennetworking.org>

SPDX-License-Identifier: Apache-2.0
--> <!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Open Network Operating System (ONOS)"><meta name=author content="Open Networking Foundation"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.0.2"><title>Conformance Monitoring with TLA+ - onosproject</title><link rel=stylesheet href=../../assets/stylesheets/application.982221ab.css><script src=../../assets/javascripts/modernizr.1f0bcf2b.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=stylesheet href=../../styles/css/extra.css><link rel=stylesheet href=../../theme/css/onos-menu.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github> <path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z"/> </svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#conformance-monitoring-with-tla tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=../.. title=onosproject class="md-header-nav__button md-logo"> <img src=../../images/onos_logo_2017.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> onosproject </span> <span class=md-header-nav__topic> Conformance Monitoring with TLA+ </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/onosproject title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> onosproject </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=../.. title=onosproject class="md-nav__button md-logo"> <img src=../../images/onos_logo_2017.png width=48 height=48> </a> onosproject </label> <div class=md-nav__source> <a href=https://github.com/onosproject title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> onosproject </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=ONOS class=md-nav__link> ONOS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Developers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Developers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/community-info/ title="Contacts and Calendars" class=md-nav__link> Contacts and Calendars </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/prerequisites/ title="Development Prerequisites" class=md-nav__link> Development Prerequisites </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/dev_workflow/ title="Developer Workflow" class=md-nav__link> Developer Workflow </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/contributing/ title="Contribution Guidelines" class=md-nav__link> Contribution Guidelines </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/godocs/ title="GoDoc Pages" class=md-nav__link> GoDoc Pages </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/deploy_with_helm/ title="Deploy with Helm" class=md-nav__link> Deploy with Helm </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/deploy_onos_classic/ title="Deploy ONOS classic" class=md-nav__link> Deploy ONOS classic </a> </li> <li class=md-nav__item> <a href=../../onos-docs/docs/content/developers/deploy_on_gcp/ title="Deploy with Helm on GCP" class=md-nav__link> Deploy with Helm on GCP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Configuration Subsystem </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Configuration Subsystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-config/docs/ title="An Introduction to Configuration Susbsytem" class=md-nav__link> An Introduction to Configuration Susbsytem </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/build/ title="How To Build Configuration Subsystem?" class=md-nav__link> How To Build Configuration Subsystem? </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/run/ title="How To Run Configuration Subsystem?" class=md-nav__link> How To Run Configuration Subsystem? </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/deployment/ title="How To Deploy with Helm" class=md-nav__link> How To Deploy with Helm </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/cli/ title="Administrative CLI" class=md-nav__link> Administrative CLI </a> </li> <li class=md-nav__item> <a href=../../onos-config-model/docs/modelplugin/ title="Configuration Model Plugins" class=md-nav__link> Configuration Model Plugins </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/gnmi/ title="Northbound gNMI Service" class=md-nav__link> Northbound gNMI Service </a> </li> <li class=md-nav__item> <a href=../../onos-config/docs/gnmi_extensions/ title="gNMI Extensions" class=md-nav__link> gNMI Extensions </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-9 type=checkbox id=nav-3-9> <label class=md-nav__link for=nav-3-9> APIs </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-9> APIs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/admin/ title="Admin API" class=md-nav__link> Admin API </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-9-2 type=checkbox id=nav-3-9-2> <label class=md-nav__link for=nav-3-9-2> Types </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-3-9-2> Types </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/v2/value/ title="Value Types" class=md-nav__link> Value Types </a> </li> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/v2/configuration/ title="Configuration Types" class=md-nav__link> Configuration Types </a> </li> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/v2/transaction/ title="Transaction Types" class=md-nav__link> Transaction Types </a> </li> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/v2/proposal/ title="Proposal Types" class=md-nav__link> Proposal Types </a> </li> <li class=md-nav__item> <a href=../../onos-api/docs/onos/config/v2/extensions/ title="Extension Types" class=md-nav__link> Extension Types </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Topology Subsystem </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Topology Subsystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-topo/docs/cli/ title="How To Use Topology Subsystem CLI?" class=md-nav__link> How To Use Topology Subsystem CLI? </a> </li> <li class=md-nav__item> <a href=../../onos-topo/docs/deployment/ title="How To Deploy with Helm" class=md-nav__link> How To Deploy with Helm </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> APIs </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> APIs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-api/docs/onos/topo/topo/ title="Entity, Kind, Relationship API" class=md-nav__link> Entity, Kind, Relationship API </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Command Line Interface Subsystem (CLI) </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Command Line Interface Subsystem (CLI) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-cli/docs/setup/ title="How To Install and Run CLI Subsystem?" class=md-nav__link> How To Install and Run CLI Subsystem? </a> </li> <li class=md-nav__item> <a href=../../onos-cli/docs/deployment/ title="How To Deploy with Helm" class=md-nav__link> How To Deploy with Helm </a> </li> <li class=md-nav__item> <a href=../../onos-cli/docs/cli/onos/ title="ONOS CLI Commands" class=md-nav__link> ONOS CLI Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Graphical User Interface (GUI) </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Graphical User Interface (GUI) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-gui/docs/ title="ONOS-GUI Subsystem" class=md-nav__link> ONOS-GUI Subsystem </a> </li> <li class=md-nav__item> <a href=../../onos-gui/docs/config-gui/ title="Configuration GUI" class=md-nav__link> Configuration GUI </a> </li> <li class=md-nav__item> <a href=../../onos-gui/docs/ran-gui/ title="SD-RAN GUI" class=md-nav__link> SD-RAN GUI </a> </li> <li class=md-nav__item> <a href=../../onos-gui/docs/architecture/ title="GUI Architecture" class=md-nav__link> GUI Architecture </a> </li> <li class=md-nav__item> <a href=../../onos-gui/docs/prerequisites/ title="GUI Development Prerequisites" class=md-nav__link> GUI Development Prerequisites </a> </li> <li class=md-nav__item> <a href=../../onos-gui/docs/deployment/ title="How to Deploy and Run with Helm?" class=md-nav__link> How to Deploy and Run with Helm? </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Test Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Test Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../helmit/docs/cli/ title="Getting Started with Helmit" class=md-nav__link> Getting Started with Helmit </a> </li> <li class=md-nav__item> <a href=../../helmit/docs/api/ title="Kubernetes and Helm APIs" class=md-nav__link> Kubernetes and Helm APIs </a> </li> <li class=md-nav__item> <a href=../../helmit/docs/testing/ title=Testing class=md-nav__link> Testing </a> </li> <li class=md-nav__item> <a href=../../helmit/docs/benchmarking/ title=Benchmarking class=md-nav__link> Benchmarking </a> </li> <li class=md-nav__item> <a href=../../helmit/docs/simulation/ title="Randomized Simulations" class=md-nav__link> Randomized Simulations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8 checked> <label class=md-nav__link for=nav-8> Logging and Monitoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Logging and Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Logging </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Logging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../onos-lib-go/docs/logging/logging/ title="Overview of Logging" class=md-nav__link> Overview of Logging </a> </li> <li class=md-nav__item> <a href=../../onos-lib-go/docs/logging/api/logging/ title="Logging API" class=md-nav__link> Logging API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Conformance Monitoring with TLA+ </label> <a href=./ title="Conformance Monitoring with TLA+" class="md-nav__link md-nav__link--active"> Conformance Monitoring with TLA+ </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#deployment title=Deployment class=md-nav__link> Deployment </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites title=Prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#installation title=Installation class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#specifications title=Specifications class=md-nav__link> Specifications </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#deployment title=Deployment class=md-nav__link> Deployment </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites title=Prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#installation title=Installation class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#specifications title=Specifications class=md-nav__link> Specifications </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=conformance-monitoring-with-tla>Conformance Monitoring with TLA+</h1> <p>Distributed systems like µONOS can be difficult to design and even harder to implement. When systems don't strictly conform to their intended properties, unpredictable behaviors can emerge. Even with good design and coding practices in place, building confidence in a distributed system can require extensive testing and evaluation.</p> <p>To aid in the identification of concurrency bugs and help build confidence µONOS services adhere to their specifications, µONOS supports a special form of monitoring designed to detect violations of the system's properties. <em>Conformance monitoring</em> in µONOS uses formal modelling techniques to specify and verify system properties in near-real time.</p> <h2 id=deployment>Deployment</h2> <p>When performance conformance monitoring on a µONOS cluster, users must use <a href=https://helm.sh/ >Helm</a> to deploy a single monitor pod per <a href=https://lamport.azurewebsites.net/tla/tla.html>TLA+</a> specification.</p> <h3 id=prerequisites>Prerequisites</h3> <p>The conformance monitor currently requires Kafka to stream traces to TLC.</p> <p>To deploy Kafka using Helm, first add the incubator repository to your Helm configuration:</p> <div class=codehilite><pre><span></span>$ helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
</pre></div> <p>Define a <code>values.yaml</code> file for your Kafka cluster, configuring the topics to be used by the conformance monitor to consume traces and produce alerts:</p> <div class=codehilite><pre><span></span><span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=nt>zookeeper</span><span class=p>:</span>
  <span class=nt>replicaCount</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=nt>topics</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">traces</span>
    <span class=nt>partitions</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class=nt>replicationFactor</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alerts</span>
    <span class=nt>partitions</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class=nt>replicationFactor</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div> <p>Then, install the <code>incubator/kafka</code> chart with the desired configuration overrides:</p> <div class=codehilite><pre><span></span>$ helm install kafka incubator/kafka --values values.yaml
</pre></div> <p>The successful completion of the <code>kafka-config</code> pod indicates the Kafka brokers have completed startup and configured topics have been created.</p> <h3 id=installation>Installation</h3> <p>Once the Kafka cluster has been configured, this chart can be deployed to perform near real-time conformance monitoring on Kafka streams. The monitor uses <a href=https://lamport.azurewebsites.net/tla/tla.html>TLA+</a> specifications to evaluate traces received from Kafka, and invariants specified in the chart configuration can detect safety violations in the trace stream.</p> <p>Several artifacts are required to by the chart:</p> <ul> <li><code>model</code> - the name of the module to evaluate</li> <li><code>modules</code> - an array of TLA+ module files to mount to the monitor pod</li> <li><code>spec</code> - the specification to evaluate</li> <li><code>init</code> - the state initialization predicate (required if <code>spec</code> is not configured)</li> <li><code>next</code> - the next state relation (required if <code>spec</code> is not configured)</li> </ul> <p>Additional options can be used to specify invariants and other constraints on the model checker:</p> <ul> <li><code>invariants</code> - an array of invariants to check for each trace</li> <li><code>constants</code> - a mapping of constant values to assign to the model</li> <li><code>constraints</code> - an array of state constraints</li> <li><code>properties</code> - an array of model properties</li> </ul> <div class=codehilite><pre><span></span>$ helm install my-monitor --set <span class=nv>modules</span><span class=o>={</span>Cache.tla,CacheHistory.tla<span class=o>}</span> --set <span class=nv>model</span><span class=o>=</span>Cache.tla --set config.spec<span class=o>=</span>Spec --set config.invariants<span class=o>={</span>TypeOK<span class=o>}</span>
</pre></div> <h2 id=specifications>Specifications</h2> <p>The role of the conformance monitor is to track the system state over time and detect violations of safety guarantees by analyzing the system state. To do so, <a href=https://lamport.azurewebsites.net/tla/tla.html>TLA+</a> specifications are used to provide a formal model for state transitions and specify the invariants to which the system must conform.</p> <p>TLA+ specifications consist of one or more modules defined in <code>.tla</code> files. A module defines a set of formulas for evaluating the state of the system. The specification provides a formula describing the initial system state and its transitions:</p> <div class=codehilite><pre><span></span><span class=c1>---------------------------- MODULE MonotonicTrace --------------------------</span>

<span class=n>EXTENDS</span><span class=w> </span><span class=n>Naturals</span><span class=p>,</span><span class=w> </span><span class=n>Sequences</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>spec</span><span class=w></span>
<span class=n>vars</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=p>...</span><span class=o>&gt;&gt;</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>init</span><span class=w> </span><span class=n>predicate</span><span class=w> </span><span class=n>describing</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>initial</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>system</span><span class=w></span>
<span class=n>Init</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=p>...</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>next</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>relation</span><span class=w> </span><span class=n>describing</span><span class=w> </span><span class=n>possible</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>transitions</span><span class=w></span>
<span class=k>Next</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=p>...</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>system</span><span class=w> </span><span class=n>specification</span><span class=w> </span><span class=n>describes</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>initial</span><span class=w> </span><span class=k>system</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=k>next</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>relations</span><span class=w></span>
<span class=n>Spec</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Init</span><span class=w> </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=err>[]</span><span class=o>[</span><span class=n>Next</span><span class=o>]</span><span class=n>_</span><span class=o>&lt;&lt;</span><span class=n>vars</span><span class=o>&gt;&gt;</span><span class=w></span>

<span class=o>=============================================================================</span><span class=w></span>
</pre></div> <p>Typically, the TLA+ model checker, TLC, computes and evaluates every state that can be reached by the spec according to its initial state and next state relation. Conformance monitoring specs operate on an infinite stream of traces, using the <code>NextTrace</code> operator to consume and check traces in near-real time:</p> <div class=codehilite><pre><span></span><span class=n>INSTANCE</span> <span class=n>Traces</span>

<span class=err>\</span><span class=o>*</span> <span class=n>The</span> <span class=n>previous</span> <span class=n>trace</span> <span class=k>version</span>
<span class=k>VARIABLE</span> <span class=n>prevVersion</span>

<span class=err>\</span><span class=o>*</span> <span class=n>The</span> <span class=k>current</span> <span class=n>trace</span> <span class=k>version</span>
<span class=k>VARIABLE</span> <span class=n>nextVersion</span>

<span class=err>\</span><span class=o>*</span> <span class=n>A</span> <span class=n>list</span> <span class=k>of</span> <span class=n>variables</span> <span class=k>in</span> <span class=n>the</span> <span class=n>spec</span>
<span class=n>vars</span> <span class=o>==</span> <span class=o>&lt;&lt;</span><span class=n>prevVersion</span><span class=p>,</span> <span class=n>nextVersion</span><span class=o>&gt;&gt;</span>

<span class=err>\</span><span class=o>*</span> <span class=k>Read</span> <span class=n>a</span> <span class=n>trace</span> <span class=n>record</span> <span class=k>from</span> <span class=n>the</span> <span class=n>stream</span> <span class=k>and</span> <span class=k>update</span> <span class=n>the</span> <span class=n>previous</span> <span class=k>and</span> <span class=k>next</span> <span class=n>versions</span>
<span class=k>Read</span> <span class=o>==</span>
    <span class=n>LET</span> <span class=n>record</span> <span class=o>==</span> <span class=n>NextTrace</span>
    <span class=k>IN</span>
       <span class=o>/</span><span class=err>\</span> <span class=n>PrintT</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
       <span class=o>/</span><span class=err>\</span> <span class=n>prevVersion</span><span class=s1>&#39; = nextVersion</span>
<span class=s1>       /\ nextVersion&#39;</span> <span class=o>=</span> <span class=n>record</span><span class=p>.</span><span class=k>version</span>

<span class=err>\</span><span class=o>*</span> <span class=n>The</span> <span class=n>init</span> <span class=n>predicate</span> <span class=n>describing</span> <span class=n>the</span> <span class=n>initial</span> <span class=k>state</span> <span class=k>of</span> <span class=n>the</span> <span class=k>system</span>
<span class=n>Init</span> <span class=o>==</span>
    <span class=o>/</span><span class=err>\</span> <span class=n>prevVersion</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=o>/</span><span class=err>\</span> <span class=n>nextVersion</span> <span class=o>=</span> <span class=mi>0</span>

<span class=err>\</span><span class=o>*</span> <span class=n>The</span> <span class=k>next</span> <span class=k>state</span> <span class=n>relation</span> <span class=n>describing</span> <span class=n>possible</span> <span class=k>state</span> <span class=n>transitions</span>
<span class=k>Next</span> <span class=o>==</span>
    <span class=err>\</span><span class=o>/</span> <span class=k>Read</span>
    <span class=err>\</span><span class=o>/</span> <span class=n>UNCHANGED</span> <span class=o>&lt;&lt;</span><span class=n>vars</span><span class=o>&gt;&gt;</span>
</pre></div> <p>The final component of a conformance spec is the invariant(s). Invariants are predicates that describe the properties of a well behaved (conforming) system. After each trace is consumed and processed from the traces stream, TLC will evaluate invariants to determine whether the system's state conforms to its safety properties:</p> <div class=codehilite><pre><span></span><span class=err>\* An invariant verifying that the trace version is monotonically increasing</span>
<span class=err>TypeOK == nextVersion # 0 =&gt; nextVersion &lt; prevVersion</span>
</pre></div> <p>In the event the invariant is violated by the system traces, the <code>PublishAlert</code> operator can be used to publish an alert.</p> <div class=codehilite><pre><span></span><span class=n>INSTANCE</span> <span class=n>Alerts</span>

<span class=err>\</span><span class=o>*</span> <span class=n>An</span> <span class=n>invariant</span> <span class=n>verifying</span> <span class=n>that</span> <span class=n>the</span> <span class=n>trace</span> <span class=k>version</span> <span class=k>is</span> <span class=n>monotonically</span> <span class=n>increasing</span>
<span class=n>TypeOK</span> <span class=o>==</span>
    <span class=err>\</span><span class=o>/</span> <span class=n>nextVersion</span> <span class=o>#</span> <span class=mi>0</span> <span class=o>=&gt;</span> <span class=n>nextVersion</span> <span class=o>&lt;</span> <span class=n>prevVersion</span>
    <span class=err>\</span><span class=o>/</span> <span class=n>PublishAlert</span><span class=p>([</span><span class=n>msg</span>         <span class=o>|-&gt;</span> <span class=ss>&quot;Invariant violated&quot;</span><span class=p>,</span>
                     <span class=n>prevVersion</span> <span class=o>|-&gt;</span> <span class=n>prevVersion</span><span class=p>,</span>
                     <span class=n>nextVersion</span> <span class=o>|-&gt;</span> <span class=n>nextVersion</span><span class=p>])</span>
</pre></div> <p>With the initial state predicate, the next state relation, and the type invariants, a complete conformance monitoring spec can be compiled:</p> <div class=codehilite><pre><span></span><span class=c1>---------------------------- MODULE MonotonicTrace --------------------------</span>

<span class=n>EXTENDS</span><span class=w> </span><span class=n>Naturals</span><span class=p>,</span><span class=w> </span><span class=n>Sequences</span><span class=w></span>

<span class=n>INSTANCE</span><span class=w> </span><span class=n>Traces</span><span class=w></span>

<span class=n>INSTANCE</span><span class=w> </span><span class=n>Alerts</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>previous</span><span class=w> </span><span class=n>trace</span><span class=w> </span><span class=n>version</span><span class=w></span>
<span class=k>VARIABLE</span><span class=w> </span><span class=n>prevVersion</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>current</span><span class=w> </span><span class=n>trace</span><span class=w> </span><span class=n>version</span><span class=w></span>
<span class=k>VARIABLE</span><span class=w> </span><span class=n>nextVersion</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>spec</span><span class=w></span>
<span class=n>vars</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=n>prevVersion</span><span class=p>,</span><span class=w> </span><span class=n>nextVersion</span><span class=o>&gt;&gt;</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>An</span><span class=w> </span><span class=n>invariant</span><span class=w> </span><span class=n>verifying</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>trace</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>monotonically</span><span class=w> </span><span class=n>increasing</span><span class=w></span>
<span class=n>TypeOK</span><span class=w> </span><span class=o>==</span><span class=w></span>
<span class=w>    </span><span class=err>\</span><span class=o>/</span><span class=w> </span><span class=n>nextVersion</span><span class=w> </span><span class=err>#</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>nextVersion</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>prevVersion</span><span class=w></span>
<span class=w>    </span><span class=err>\</span><span class=o>/</span><span class=w> </span><span class=n>PublishAlert</span><span class=p>(</span><span class=o>[</span><span class=n>msg         |-&gt; &quot;Invariant violated&quot;,</span>
<span class=n>                     prevVersion |-&gt; prevVersion,</span>
<span class=n>                     nextVersion |-&gt; nextVersion</span><span class=o>]</span><span class=p>)</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=k>Read</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>trace</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>traces</span><span class=w> </span><span class=n>stream</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=k>update</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>previous</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=k>next</span><span class=w> </span><span class=n>versions</span><span class=w></span>
<span class=k>Read</span><span class=w> </span><span class=o>==</span><span class=w></span>
<span class=w>    </span><span class=n>LET</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>NextTrace</span><span class=w></span>
<span class=w>    </span><span class=ow>IN</span><span class=w></span>
<span class=w>       </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=n>PrintT</span><span class=p>(</span><span class=n>record</span><span class=p>)</span><span class=w></span>
<span class=w>       </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=n>prevVersion</span><span class=s1>&#39; = nextVersion</span>
<span class=s1>       /\ nextVersion&#39;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>record</span><span class=p>.</span><span class=n>version</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>init</span><span class=w> </span><span class=n>predicate</span><span class=w> </span><span class=n>describing</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>initial</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>system</span><span class=w></span>
<span class=n>Init</span><span class=w> </span><span class=o>==</span><span class=w></span>
<span class=w>    </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=n>prevVersion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w></span>
<span class=w>    </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=n>nextVersion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>next</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>relation</span><span class=w> </span><span class=n>describing</span><span class=w> </span><span class=n>possible</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>transitions</span><span class=w></span>
<span class=k>Next</span><span class=w> </span><span class=o>==</span><span class=w></span>
<span class=w>    </span><span class=err>\</span><span class=o>/</span><span class=w> </span><span class=k>Read</span><span class=w></span>
<span class=w>    </span><span class=err>\</span><span class=o>/</span><span class=w> </span><span class=n>UNCHANGED</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=n>vars</span><span class=o>&gt;&gt;</span><span class=w></span>

<span class=err>\</span><span class=o>*</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>system</span><span class=w> </span><span class=n>specification</span><span class=w> </span><span class=n>describes</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>initial</span><span class=w> </span><span class=k>system</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=k>next</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=n>relations</span><span class=w></span>
<span class=n>Spec</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Init</span><span class=w> </span><span class=o>/</span><span class=err>\</span><span class=w> </span><span class=err>[]</span><span class=o>[</span><span class=n>Next</span><span class=o>]</span><span class=n>_</span><span class=o>&lt;&lt;</span><span class=n>vars</span><span class=o>&gt;&gt;</span><span class=w></span>

<span class=o>=============================================================================</span><span class=w></span>
</pre></div> <p>To deploy the specification for conformance monitoring, the chart must be configured to identify the specification <code>Spec</code> and its invariant <code>TypeOK</code>:</p> <div class=codehilite><pre><span></span>$ helm install my-monitor --set <span class=nv>modules</span><span class=o>={</span>MonotonicTrace.tla<span class=o>}</span> --set <span class=nv>model</span><span class=o>=</span>MonotonicTrace.tla --set config.spec<span class=o>=</span>Spec --set config.invariants<span class=o>={</span>TypeOK<span class=o>}</span>
</pre></div> <p>The model will be initialized with the <code>prevVersion</code> and <code>nextVersion</code> set to <code>0</code>. As traces are pushed onto the traces stream, the model checker will <code>Read</code> the trace records, update the model state, and evaluate the invariant <code>TypeOK</code>.</p> </article> </div> </div> </main> <!-- Application footer --> <footer class=md-footer> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org title=MkDocs>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ title="Material for MkDocs"> Material for MkDocs</a> </div> <!-- Social links --> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/onosproject class="md-footer-social__link fa fa-"></a> <a href=https://onosproject.slack.com/ class="md-footer-social__link fa fa-"></a> <a href=https://www.youtube.com/channel/UCTQaOpqno48GTimdwyfytFw class="md-footer-social__link fa fa-"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.d9aa80ab.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../theme/js/onos-menu.js></script> </body> </html>